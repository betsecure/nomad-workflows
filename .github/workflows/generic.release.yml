# This workflow publishes a GitHub release based on a Git tag.

name: Publish Release

on:
  workflow_call:
    secrets:
      SLACK_WEBHOOK_URL:
        required: true

jobs:
  publish:
    runs-on: ubuntu-latest
    name: Publish release

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Publish release
        uses: eloquent/github-release-action@v2

      - name: Publish Slack notification
        uses: ravsamhq/notify-slack-action@v1
        if: always()
        with:
          status: ${{ job.status }}
          notify_when: "failure,warnings"
          notification_title: "<{run_url}|*{workflow}* {status_message}> for <{repo_url}|{repo}>"
          message_format: "Caused by ${{ env.CAUSE_MESSAGE }}(<{commit_url}|{branch}@{commit_sha}>)"
          footer: ""
        env:
          CAUSE_MESSAGE: ${{ github.event.head_commit.message && '"${{ github.event.head_commit.message }}" ' || '' }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
